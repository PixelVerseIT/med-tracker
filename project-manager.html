<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        input[type="text"], textarea, select {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 8px 12px;
            background: #5cb85c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        button.delete {
            background: #d9534f;
        }
        button.edit {
            background: #f0ad4e;
        }
        #projectList, .taskList, .subtaskList {
            list-style-type: none;
            padding: 0;
        }
        .project, .task, .subtask {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            border-left: 5px solid #5cb85c;
        }
        .task {
            margin-left: 20px;
            border-left-color: #5bc0de;
        }
        .subtask {
            margin-left: 40px;
            border-left-color: #f0ad4e;
        }
        .projectHeader, .taskHeader, .subtaskHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .taskDetails, .subtaskForm {
            margin-top: 10px;
        }
        .hidden {
            display: none;
        }
        #searchAndFilter {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        #searchInput {
            flex-grow: 1;
            margin-right: 10px;
        }
        #filterSelect {
            width: 150px;
        }
        .date {
            font-size: 0.8em;
            color: #666;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Project Manager</h1>
        
        <div id="searchAndFilter">
            <input type="text" id="searchInput" placeholder="Search projects, tasks, subtasks, and notes">
            <select id="filterSelect">
                <option value="all">All Tasks</option>
                <option value="completed">Completed Tasks</option>
                <option value="pending">Pending Tasks</option>
            </select>
        </div>

        <form id="projectForm">
            <input type="text" id="projectInput" placeholder="Enter a new project name" required>
            <input type="date" id="projectDate" required>
            <button type="submit">Add Project</button>
        </form>

        <ul id="projectList"></ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const projectForm = document.getElementById('projectForm');
            const projectInput = document.getElementById('projectInput');
            const projectDate = document.getElementById('projectDate');
            const projectList = document.getElementById('projectList');
            const searchInput = document.getElementById('searchInput');
            const filterSelect = document.getElementById('filterSelect');

            let projects = JSON.parse(localStorage.getItem('projects')) || [];

            const saveToLocalStorage = () => localStorage.setItem('projects', JSON.stringify(projects));

            const createElementWithClass = (tag, className) => {
                const element = document.createElement(tag);
                element.className = className;
                return element;
            };

            const createButton = (text, className, clickHandler) => {
                const button = createElementWithClass('button', className);
                button.textContent = text;
                button.addEventListener('click', clickHandler);
                return button;
            };

            const promptEdit = (item, field) => {
                const newValue = prompt(`Enter new ${field}:`, item[field]);
                if (newValue && newValue.trim()) {
                    item[field] = newValue.trim();
                    return true;
                }
                return false;
            };

            const renderItem = (item, parentList, itemType) => {
                const li = createElementWithClass('li', itemType);
                const header = createElementWithClass('div', `${itemType}Header`);
                
                if (itemType !== 'project') {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.completed;
                    checkbox.addEventListener('change', () => {
                        item.completed = checkbox.checked;
                        saveToLocalStorage();
                    });
                    header.appendChild(checkbox);
                }

                const title = document.createElement(itemType === 'project' ? 'h2' : 'h3');
                title.innerHTML = `${item.name} <span class="date">${item.date}</span>`;
                header.appendChild(title);

                const buttonContainer = document.createElement('div');
                buttonContainer.appendChild(createButton('Edit', 'edit', () => editItem(item, li, itemType)));
                buttonContainer.appendChild(createButton('Delete', 'delete', () => deleteItem(item, li, parentList, itemType)));
                
                if (itemType === 'task') {
                    buttonContainer.appendChild(createButton('Details', 'toggleDetails', () => li.querySelector('.taskDetails').classList.toggle('hidden')));
                }

                header.appendChild(buttonContainer);
                li.appendChild(header);

                if (itemType === 'project' || itemType === 'task') {
                    const form = createElementWithClass('form', `${itemType === 'project' ? 'task' : 'subtask'}Form`);
                    form.innerHTML = `
                        <input type="text" class="${itemType === 'project' ? 'task' : 'subtask'}Input" placeholder="Enter a new ${itemType === 'project' ? 'task' : 'subtask'}" required>
                        ${itemType === 'project' ? '<textarea class="taskDescription" placeholder="Task description"></textarea>' : ''}
                        <input type="date" class="${itemType === 'project' ? 'task' : 'subtask'}Date" required>
                        <button type="submit">Add ${itemType === 'project' ? 'Task' : 'Subtask'}</button>
                    `;
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const nameInput = form.querySelector(`.${itemType === 'project' ? 'task' : 'subtask'}Input`);
                        const dateInput = form.querySelector(`.${itemType === 'project' ? 'task' : 'subtask'}Date`);
                        if (nameInput.value.trim() && dateInput.value) {
                            const newItem = {
                                id: Date.now(),
                                name: nameInput.value.trim(),
                                date: dateInput.value,
                                completed: false
                            };
                            if (itemType === 'project') {
                                newItem.description = form.querySelector('.taskDescription').value;
                                newItem.notes = '';
                                newItem.subtasks = [];
                                item.tasks.push(newItem);
                            } else {
                                item.subtasks.push(newItem);
                            }
                            renderItem(newItem, li.querySelector(`.${itemType === 'project' ? 'task' : 'subtask'}List`), itemType === 'project' ? 'task' : 'subtask');
                            saveToLocalStorage();
                            form.reset();
                        }
                    });
                    li.appendChild(form);

                    const childList = createElementWithClass('ul', `${itemType === 'project' ? 'task' : 'subtask'}List`);
                    li.appendChild(childList);

                    if (itemType === 'project') {
                        item.tasks.forEach(task => renderItem(task, childList, 'task'));
                    } else if (itemType === 'task') {
                        const taskDetails = createElementWithClass('div', 'taskDetails hidden');
                        taskDetails.innerHTML = `
                            <p><strong>Description:</strong> ${item.description}</p>
                            <textarea class="taskNotes" placeholder="Add notes here">${item.notes}</textarea>
                        `;
                        taskDetails.querySelector('.taskNotes').addEventListener('input', (e) => {
                            item.notes = e.target.value;
                            saveToLocalStorage();
                        });
                        li.appendChild(taskDetails);
                        item.subtasks.forEach(subtask => renderItem(subtask, childList, 'subtask'));
                    }
                }

                parentList.appendChild(li);
            };

            const editItem = (item, itemElement, itemType) => {
                if (promptEdit(item, 'name') && promptEdit(item, 'date')) {
                    const header = itemElement.querySelector(`.${itemType}Header`);
                    const title = header.querySelector(itemType === 'project' ? 'h2' : 'h3');
                    title.innerHTML = `${item.name} <span class="date">${item.date}</span>`;
                    if (itemType === 'task') {
                        promptEdit(item, 'description');
                        itemElement.querySelector('.taskDetails p').innerHTML = `<strong>Description:</strong> ${item.description}`;
                    }
                    saveToLocalStorage();
                }
            };

            const deleteItem = (item, itemElement, parentList, itemType) => {
                if (confirm(`Are you sure you want to delete this ${itemType}?`)) {
                    if (itemType === 'project') {
                        projects = projects.filter(p => p.id !== item.id);
                    } else if (itemType === 'task') {
                        const project = projects.find(p => p.tasks.some(t => t.id === item.id));
                        project.tasks = project.tasks.filter(t => t.id !== item.id);
                    } else {
                        const task = projects.flatMap(p => p.tasks).find(t => t.subtasks.some(s => s.id === item.id));
                        task.subtasks = task.subtasks.filter(s => s.id !== item.id);
                    }
                    parentList.removeChild(itemElement);
                    saveToLocalStorage();
                }
            };

            const filterProjects = (searchTerm, filterValue) => {
                projectList.innerHTML = '';
                projects.forEach(project => {
                    const filteredProject = {
                        ...project,
                        tasks: project.tasks.filter(task => {
                            const matchesSearch = task.name.toLowerCase().includes(searchTerm) ||
                                                  task.description.toLowerCase().includes(searchTerm) ||
                                                  task.notes.toLowerCase().includes(searchTerm) ||
                                                  task.subtasks.some(subtask => subtask.name.toLowerCase().includes(searchTerm));
                            const matchesFilter = filterValue === 'all' ||
                                                  (filterValue === 'completed' && task.completed) ||
                                                  (filterValue === 'pending' && !task.completed);
                            return matchesSearch && matchesFilter;
                        })
                    };

                    if (project.name.toLowerCase().includes(searchTerm) || 
                        project.date.includes(searchTerm) || 
                        filteredProject.tasks.length > 0) {
                        renderItem(filteredProject, projectList, 'project');
                    }
                });
            };

            projectForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (projectInput.value.trim() && projectDate.value) {
                    const newProject = {
                        id: Date.now(),
                        name: projectInput.value.trim(),
                        date: projectDate.value,
                        tasks: []
                    };
                    projects.push(newProject);
                    renderItem(newProject, projectList, 'project');
                    saveToLocalStorage();
                    projectForm.reset();
                }
            });

            searchInput.addEventListener('input', () => filterProjects(searchInput.value.toLowerCase(), filterSelect.value));
            filterSelect.addEventListener('change', () => filterProjects(searchInput.value.toLowerCase(), filterSelect.value));

            projects.forEach(project => renderItem(project, projectList, 'project'));
        });
    </script>
</body>
</html>