<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto max-w-3xl p-4">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">Project Manager</h1>
        
        <div class="flex mb-4">
            <input type="text" id="searchInput" placeholder="Search projects, tasks, subtasks, and notes" class="flex-grow mr-2 p-2 border border-gray-300 rounded">
            <select id="filterSelect" class="w-40 p-2 border border-gray-300 rounded">
                <option value="all">All Tasks</option>
                <option value="completed">Completed Tasks</option>
                <option value="pending">Pending Tasks</option>
            </select>
        </div>

        <form id="projectForm" class="mb-6">
            <input type="text" id="projectInput" placeholder="Enter a new project name" required class="w-full mb-2 p-2 border border-gray-300 rounded">
            <div class="flex">
                <input type="date" id="projectDate" required class="flex-grow mr-2 p-2 border border-gray-300 rounded">
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Add Project</button>
            </div>
        </form>

        <ul id="projectList" class="space-y-4"></ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const projectForm = document.getElementById('projectForm');
            const projectInput = document.getElementById('projectInput');
            const projectDate = document.getElementById('projectDate');
            const projectList = document.getElementById('projectList');
            const searchInput = document.getElementById('searchInput');
            const filterSelect = document.getElementById('filterSelect');

            let projects = JSON.parse(localStorage.getItem('projects')) || [];

            const saveToLocalStorage = () => localStorage.setItem('projects', JSON.stringify(projects));

            const createElementWithClass = (tag, className) => {
                const element = document.createElement(tag);
                element.className = className;
                return element;
            };

            const createButton = (text, className, clickHandler) => {
                const button = createElementWithClass('button', `${className} px-2 py-1 rounded text-white text-sm mr-1`);
                button.textContent = text;
                button.addEventListener('click', clickHandler);
                return button;
            };

            const promptEdit = (item, field) => {
                const newValue = prompt(`Enter new ${field}:`, item[field]);
                if (newValue && newValue.trim()) {
                    item[field] = newValue.trim();
                    return true;
                }
                return false;
            };

            const renderItem = (item, parentList, itemType) => {
                const li = createElementWithClass('li', `${itemType} bg-white p-4 rounded shadow`);
                const header = createElementWithClass('div', `${itemType}Header flex justify-between items-center mb-2`);
                
                if (itemType !== 'project') {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.completed;
                    checkbox.className = 'mr-2';
                    checkbox.addEventListener('change', () => {
                        item.completed = checkbox.checked;
                        saveToLocalStorage();
                    });
                    header.appendChild(checkbox);
                }

                const title = document.createElement(itemType === 'project' ? 'h2' : 'h3');
                title.className = itemType === 'project' ? 'text-xl font-semibold' : 'text-lg font-medium';
                title.innerHTML = `${item.name} <span class="text-sm text-gray-500 ml-2">${item.date}</span>`;
                header.appendChild(title);

                const buttonContainer = createElementWithClass('div', 'flex');
                buttonContainer.appendChild(createButton('Edit', 'bg-yellow-500 hover:bg-yellow-600', () => editItem(item, li, itemType)));
                buttonContainer.appendChild(createButton('Delete', 'bg-red-500 hover:bg-red-600', () => deleteItem(item, li, parentList, itemType)));
                
                if (itemType === 'task') {
                    buttonContainer.appendChild(createButton('Details', 'bg-blue-500 hover:bg-blue-600', () => li.querySelector('.taskDetails').classList.toggle('hidden')));
                }

                header.appendChild(buttonContainer);
                li.appendChild(header);

                if (itemType === 'project' || itemType === 'task') {
                    const form = createElementWithClass('form', `${itemType === 'project' ? 'task' : 'subtask'}Form mt-4`);
                    form.innerHTML = `
                        <input type="text" class="${itemType === 'project' ? 'task' : 'subtask'}Input w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Enter a new ${itemType === 'project' ? 'task' : 'subtask'}" required>
                        ${itemType === 'project' ? '<textarea class="taskDescription w-full mb-2 p-2 border border-gray-300 rounded" placeholder="Task description"></textarea>' : ''}
                        <div class="flex">
                            <input type="date" class="${itemType === 'project' ? 'task' : 'subtask'}Date flex-grow mr-2 p-2 border border-gray-300 rounded" required>
                            <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Add ${itemType === 'project' ? 'Task' : 'Subtask'}</button>
                        </div>
                    `;
                    form.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const nameInput = form.querySelector(`.${itemType === 'project' ? 'task' : 'subtask'}Input`);
                        const dateInput = form.querySelector(`.${itemType === 'project' ? 'task' : 'subtask'}Date`);
                        if (nameInput.value.trim() && dateInput.value) {
                            const newItem = {
                                id: Date.now(),
                                name: nameInput.value.trim(),
                                date: dateInput.value,
                                completed: false
                            };
                            if (itemType === 'project') {
                                newItem.description = form.querySelector('.taskDescription').value;
                                newItem.notes = '';
                                newItem.subtasks = [];
                                item.tasks.push(newItem);
                            } else {
                                item.subtasks.push(newItem);
                            }
                            renderItem(newItem, li.querySelector(`.${itemType === 'project' ? 'task' : 'subtask'}List`), itemType === 'project' ? 'task' : 'subtask');
                            saveToLocalStorage();
                            form.reset();
                        }
                    });
                    li.appendChild(form);

                    const childList = createElementWithClass('ul', `${itemType === 'project' ? 'task' : 'subtask'}List mt-4 space-y-2`);
                    li.appendChild(childList);

                    if (itemType === 'project') {
                        item.tasks.forEach(task => renderItem(task, childList, 'task'));
                    } else if (itemType === 'task') {
                        const taskDetails = createElementWithClass('div', 'taskDetails hidden mt-4');
                        taskDetails.innerHTML = `
                            <p class="mb-2"><strong>Description:</strong> ${item.description}</p>
                            <textarea class="taskNotes w-full p-2 border border-gray-300 rounded" placeholder="Add notes here">${item.notes}</textarea>
                        `;
                        taskDetails.querySelector('.taskNotes').addEventListener('input', (e) => {
                            item.notes = e.target.value;
                            saveToLocalStorage();
                        });
                        li.appendChild(taskDetails);
                        item.subtasks.forEach(subtask => renderItem(subtask, childList, 'subtask'));
                    }
                }

                parentList.appendChild(li);
            };

            const editItem = (item, itemElement, itemType) => {
                if (promptEdit(item, 'name') && promptEdit(item, 'date')) {
                    const header = itemElement.querySelector(`.${itemType}Header`);
                    const title = header.querySelector(itemType === 'project' ? 'h2' : 'h3');
                    title.innerHTML = `${item.name} <span class="text-sm text-gray-500 ml-2">${item.date}</span>`;
                    if (itemType === 'task') {
                        promptEdit(item, 'description');
                        itemElement.querySelector('.taskDetails p').innerHTML = `<strong>Description:</strong> ${item.description}`;
                    }
                    saveToLocalStorage();
                }
            };

            const deleteItem = (item, itemElement, parentList, itemType) => {
                if (confirm(`Are you sure you want to delete this ${itemType}?`)) {
                    if (itemType === 'project') {
                        projects = projects.filter(p => p.id !== item.id);
                    } else if (itemType === 'task') {
                        const project = projects.find(p => p.tasks.some(t => t.id === item.id));
                        project.tasks = project.tasks.filter(t => t.id !== item.id);
                    } else {
                        const task = projects.flatMap(p => p.tasks).find(t => t.subtasks.some(s => s.id === item.id));
                        task.subtasks = task.subtasks.filter(s => s.id !== item.id);
                    }
                    parentList.removeChild(itemElement);
                    saveToLocalStorage();
                }
            };

            const filterProjects = (searchTerm, filterValue) => {
                projectList.innerHTML = '';
                projects.forEach(project => {
                    const filteredProject = {
                        ...project,
                        tasks: project.tasks.filter(task => {
                            const matchesSearch = task.name.toLowerCase().includes(searchTerm) ||
                                                  task.description.toLowerCase().includes(searchTerm) ||
                                                  task.notes.toLowerCase().includes(searchTerm) ||
                                                  task.subtasks.some(subtask => subtask.name.toLowerCase().includes(searchTerm));
                            const matchesFilter = filterValue === 'all' ||
                                                  (filterValue === 'completed' && task.completed) ||
                                                  (filterValue === 'pending' && !task.completed);
                            return matchesSearch && matchesFilter;
                        })
                    };

                    if (project.name.toLowerCase().includes(searchTerm) || 
                        project.date.includes(searchTerm) || 
                        filteredProject.tasks.length > 0) {
                        renderItem(filteredProject, projectList, 'project');
                    }
                });
            };

            projectForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (projectInput.value.trim() && projectDate.value) {
                    const newProject = {
                        id: Date.now(),
                        name: projectInput.value.trim(),
                        date: projectDate.value,
                        tasks: []
                    };
                    projects.push(newProject);
                    renderItem(newProject, projectList, 'project');
                    saveToLocalStorage();
                    projectForm.reset();
                }
            });

            searchInput.addEventListener('input', () => filterProjects(searchInput.value.toLowerCase(), filterSelect.value));
            filterSelect.addEventListener('change', () => filterProjects(searchInput.value.toLowerCase(), filterSelect.value));

            projects.forEach(project => renderItem(project, projectList, 'project'));
        });
    </script>
</body>
</html>